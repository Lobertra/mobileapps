package com.example.tungnguyen.basicexploition;

import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.drawable.AnimationDrawable;
import android.graphics.drawable.BitmapDrawable;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.view.View;
import android.widget.ImageView;

import java.util.ArrayList;

public class MainActivity extends AppCompatActivity {

    private final int ROW = 5;
    private final int COL = 5;

    private Bitmap explosionImage;

    private ArrayList<Bitmap> explosionFrames = new ArrayList<>();
    private AnimationDrawable animationDrawable;

    private ImageView imageView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        imageView = findViewById(R.id.imageView);

        //making the load a little bit faster by using another thread for image processing:)
        new Thread(new Runnable() {
            @Override
            public void run() {
                explosionImage = BitmapFactory.decodeResource(getResources(), R.drawable.explosion);
                generateBitmaps(explosionImage, ROW, COL);
                animationDrawable = new AnimationDrawable();
                for (Bitmap b :
                        explosionFrames) {
                    animationDrawable.addFrame(new BitmapDrawable(getResources(), b), 50);
                }
                imageView.setImageDrawable(animationDrawable);
            }
        }).start();


        findViewById(R.id.constraintLayout).setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                if(animationDrawable.isRunning()){
                    animationDrawable.stop();
                } else{
                    animationDrawable.start();
                }
            }
        });
    }

    private void generateBitmaps(Bitmap bitmap, int row, int col){
        int fWidth = explosionImage.getWidth()/col;
        int fHeight = explosionImage.getWidth()/row;

        for (int r = 0; r < row; r++) {
            for (int c = 0; c < col; c++) {
                Bitmap frame = Bitmap.createBitmap(bitmap, c*fWidth, r*fHeight, fWidth, fHeight);
                explosionFrames.add(frame);
            }
        }

    }
}
